# KowareyukuJapan 本番環境開発ロードマップ

このドキュメントは、KowareyukuJapanプロジェクトの本番環境に向けた開発指針を定めたものです。
**全ての開発作業はこのロードマップに従って実施してください。**

## 📋 開発方針

低コストで迅速に立ち上げ、リスクを管理しながら着実にサービスを成長させ、最終的に持続可能な運営を目指します。

## 🚀 フェーズ別実装計画

### フェーズ1：基盤構築と安定運用（1-2週間）

**目標**: サービスの核となる機能を整備し、安全に運用できる環境を構築する

#### 1.1 管理機能の実装
- **管理者認証**: Auth.js + Passkey/Email-Link（最低コスト）
  - ロール設計: admin, moderator, editor, viewer
- **管理UI**:
  - 投稿一覧（検索/フィルタ/タグ/期間）
  - 一括操作（非公開・削除・タグ付け）
  - 監査ログ（誰が何をいつ変更したか）
- **自動モデレーション**:
  - NGワードフィルター（自動非表示）
  - スパム検出（連続投稿制限、同一IP制限）
  - レート制限（@upstash/ratelimit 無料枠）
  - 通報機能＋自動しきい値アクション（N通報で非公開）

#### 1.2 データ永続化とバックアップ
- **データベース**: 
  - Turso/LibSQL または Cloudflare D1（SQLite互換・無料枠からスタート）
  - 将来的にPostgres（Neon/Supabase）への移行を想定
- **メディアストレージ**: 
  - Cloudflare R2（画像/動画、転送料が非常に安価）
  - 署名URLによる直接アップロード（帯域/コスト削減）
- **バックアップ**: 
  - DBダンプを毎日自動でR2に保存
  - 復元手順のドキュメント化

#### 1.3 リスク対策と法的整備
- **利用規約・プライバシーポリシー**の整備
- **著作権侵害対応フロー**（DMCA削除要請）
- **特定電気通信役務提供者法**への対応準備
- **CSPヘッダー**の適切な設定

### フェーズ2：運用効率化と成長促進（2-3週間）

**目標**: 手動作業を自動化し、ユーザーが自然に集まる仕組みを作る

#### 2.1 コンテンツ自動収集システム
- **スケジューラ**: Vercel Cron または Cloudflare Workers Cron
- **収集パイプライン**:
  1. 取得 → 正規化 → 重複排除 → タグ自動付与 → レビュー → 公開
  2. 障害時キュー/リトライ（Upstash QStash/Redis Queue）
- **収集源**:
  - ニュース: RSS/Atom（Yahoo!ニュース、省庁、公式サイト）
  - YouTube: Data API（チャンネル/キーワード）※クオータ監視必須
  - X(Twitter): 公式APIは有償前提、手動登録支援＋埋め込み中心に
- **管理機能**:
  - フィード設定（ソース/頻度/カテゴリ/重複閾値）
  - 自動公開/要承認トグル
  - ワンクリック停止/再開

#### 2.2 SEO・マーケティング強化
- **SEO対策**:
  - 動的OGP生成（現在は静的）
  - サイトマップ自動生成
  - 構造化データ（JSON-LD）
  - Core Web Vitals最適化
- **分析ツール**:
  - Google Analytics 4統合
  - ユーザー行動ヒートマップ（Microsoft Clarity無料）
  - Sentry（エラー監視）
- **共有促進**:
  - ワンクリック共有ボタン拡充
  - 埋め込みウィジェット提供

### フェーズ3：機能高度化と収益化（1-2ヶ月）

**目標**: ユーザー体験を向上させ、持続可能な運営モデルを確立

#### 3.1 高度な機能実装
- **ランキング機能**: いいね/シェアが多い投稿を表示
- **関連投稿推薦**: 読了後に関連性の高い投稿を推薦
- **公式キュレーター制度**: 
  - 信頼性の高い投稿者を認定
  - キュレーターの投稿を優先表示
- **ニュースレター機能**: 週次/月次でまとめを配信

#### 3.2 収益化（段階的実装）
1. **寄付システム**: Buy Me a Coffee等で理念に共感した人から支援
2. **アフィリエイト**: Amazon、楽天（関連書籍等）
3. **スポンサード枠**: 透明性を保った広告枠
4. **Google AdSense**: 審査通過後に導入（最後の手段）

## 💰 コスト試算

### 初期〜小規模（〜1,000 MAU）
```
Vercel: 無料
データベース: 無料（Turso/D1）
Cloudflare R2: 無料〜月$1
ドメイン: 月150円
-----------------------
合計: 月150〜300円
```

### 中規模（〜10,000 MAU）
```
Vercel Pro: 月$20
データベース: 月$10-25
Cloudflare R2: 月$5-10
ドメイン: 月150円
その他ツール: 月$10
-----------------------
合計: 月6,000〜8,000円
```

### 大規模（100,000+ MAU）
カスタムインフラへの移行を検討

## 📊 成功指標（KPI）

### トラフィック関連
- 月間アクティブユーザー数（MAU）
- 訪問者の滞在時間
- ページビュー/セッション

### コンテンツ関連
- 自動収集した投稿の公開率
- ユーザー投稿数
- シェア数

### 技術関連
- サイトの表示速度（Core Web Vitals）
- エラー発生率（<0.1%目標）
- API応答時間（p95 < 500ms）

## 🎯 実装優先順位（スプリント計画）

### Sprint 1（1週間）
- DB/R2導入
- 基本的な管理UI（一覧/検索/削除）
- 利用規約・プライバシーポリシー

### Sprint 2（1週間）
- レート制限・通報機能
- 監査ログ
- 重複検知・自動タグ付け

### Sprint 3（2週間）
- 自動収集ジョブ最小構成（RSS）
- SEO強化
- 分析ツール導入

### Sprint 4（2週間）
- YouTube API連携
- ランキング機能
- ニュースレター

### Sprint 5以降
- 収益化機能
- 高度な推薦システム
- パフォーマンス最適化

## ⚠️ 注意事項

### プラットフォーム規約順守
- Instagram: テキスト抽出禁止、埋め込みのみ
- X(Twitter): API利用は有償、埋め込み中心に
- YouTube: APIクオータ監視必須
- TikTok: 埋め込み規約確認必須

### セキュリティ
- CSPヘッダーの適切な設定
- XSS/CSRF対策の徹底
- 定期的な依存関係の更新
- APIキーの適切な管理

### パフォーマンス
- 画像の最適化（Sharp使用済み）
- 遅延読み込みの実装
- CDNの活用
- React Queryによるキャッシュ戦略

## 📚 技術スタック（確定）

### フロントエンド
- Next.js 15 + React 19
- TypeScript
- Tailwind CSS 4
- React Query v5（導入済み）

### バックエンド
- Next.js API Routes
- Turso/D1 → Postgres（将来）
- Cloudflare R2（メディア）
- Upstash（Redis/Queue）

### インフラ・ツール
- Vercel（ホスティング）
- Cloudflare（CDN/Security）
- Sentry（エラー監視）
- Google Analytics 4

## 🔄 定期レビュー

- 週次: 進捗確認、課題共有
- 月次: KPI分析、方針調整
- 四半期: 大きな方向性の見直し

---

**最終更新**: 2024年12月26日
**次回レビュー**: Sprint 1完了時

このロードマップは生きたドキュメントです。状況に応じて適宜更新してください。